# Railway / Nixpacks Configuration for optimized memory usage

[phases.setup]
nixPkgs = ["jdk21_headless"]

[phases.build]
cmds = ["chmod +x mvnw", "./mvnw clean package -DskipTests"]

[start]
# Memory-optimized JVM flags for Railway (512MB container):
# - Heap: 300MB max, 200MB initial
# - Metaspace: 80MB cap (prevents class metadata explosion)
# - SerialGC: lowest memory footprint
# - TieredStopAtLevel=1: faster startup, less JIT memory
cmd = "java -Xmx300m -Xms200m -XX:MaxMetaspaceSize=80m -XX:+UseSerialGC -XX:+TieredCompilation -XX:TieredStopAtLevel=1 -Djava.security.egd=file:/dev/./urandom -jar target/*.jar"
